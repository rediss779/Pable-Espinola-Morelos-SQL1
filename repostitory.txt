import java.sql.Connection;
import java.sql.DriverManager;
import java.sql.ResultSet;
import java.sql.Statement;
import java.util.ArrayList;
import java.util.List;

public class Repository {

    private static Repository instance;
    private final String url = "jdbc:sqlite:src/sqlkoto.db";

    private Repository() {}

    public static Repository getInstance() {
        if (instance == null) {
            instance = new Repository();
        }
        return instance;
    }

    public void printMasterList() {
        List<Student> students = getAllStudents();
        for (Student s : students) {
            System.out.println(s.display());
        }
    }

    private List<Student> getAllStudents() {
        List<Student> students = new ArrayList<>();
        String sql = "SELECT * FROM tbl_students";

        try (Connection conn = DriverManager.getConnection(url);
             Statement stmt = conn.createStatement();
             ResultSet rs = stmt.executeQuery(sql)) {

            while (rs.next()) {
                students.add(
                        new Student.Builder()
                                .setStudentID(rs.getInt("studentID"))
                                .setFullName(rs.getString("full_name"))
                                .setAge(rs.getInt("age"))
                                .setCourse(rs.getString("course"))
                                .setYearLevel(rs.getInt("year_level"))
                                .setSection(rs.getInt("section"))
                                .setSex(rs.getString("sex"))
                                .setContactNum(rs.getString("contact_num"))
                                .setEmail(rs.getString("email"))
                                .setAddress(rs.getString("address"))
                                .build()
                );
            }
        } catch (Exception e) {
            System.out.println("Database Error");
        }
        return students;
    }
}
